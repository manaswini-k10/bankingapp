<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Banking App â€” Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { color-scheme: dark; }
  body { font-family: system-ui, Arial, sans-serif; margin:0; background:#0e0f17; color:#eef1f7; }
  .wrap { max-width: 980px; margin: 6vh auto; padding: 28px; background:#171a23; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
  h2 { margin:0 0 6px; }
  .grid { display:grid; grid-template-columns: 1fr 1fr; gap:18px; margin-top:16px; }
  .card { background:#0e111a; border:1px solid #2b3041; border-radius:14px; padding:16px; }
  table { width:100%; border-collapse:collapse; }
  th, td { padding:8px; border-bottom:1px solid #2b3041; text-align:left; }
  .chip { display:inline-block; padding:6px 10px; border-radius:999px; background:#0e111a; border:1px solid #2b3041; margin-right:8px; }
  .btn { padding:10px 14px; border-radius:10px; border:1px solid #2b3041; background:#0e111a; color:#eef1f7; cursor:pointer; }
  .btn.primary { background:#5964ff; border-color:#5964ff; color:white; }
  input, select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2b3041; background:#0e111a; color:#eef1f7; }
  .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
</style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex; align-items:center; gap:10px;">
      <h2>Welcome, {{ name }} ðŸ‘‹</h2>
      <form action="/reset" method="post" style="margin-left:auto">
        <button class="btn" type="submit">Logout</button>
      </form>
    </div>

    <div class="grid">
      <!-- Accounts -->
      <div class="card">
        <h3>Your Accounts</h3>
        {% for a in accounts %}
          <div class="chip">{{ a.name }}: <b id="bal-{{ a.id }}">{{ a.balance }}</b></div>
        {% endfor %}
      </div>

      <!-- Transfer -->
      <div class="card">
        <h3>Transfer Money</h3>
        <form id="xferForm">
          <div class="row">
            <div>
              <label>From Account</label>
              <select name="fromAccount" required>
                {% for a in accounts %}
                  <option value="{{ a.id }}">{{ a.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div>
              <label>Amount (USD)</label>
              <input name="amount" placeholder="e.g., 25.50" required />
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <div>
              <label>To User</label>
              <input name="toUser" placeholder="e.g., alice or bob" required />
            </div>
            <div>
              <label>To Account</label>
              <select name="toAccount" required>
                <option>Checking</option>
                <option>Savings</option>
              </select>
            </div>
          </div>
          <label style="margin-top:10px;">Memo (optional)</label>
          <input name="memo" placeholder="e.g., Rent, Lunch" />
          <button class="btn primary" style="margin-top:12px;" type="submit">Send</button>
        </form>
        <div id="xferMsg" style="margin-top:8px; color:#aeb6d0;"></div>
      </div>
    </div>

    <!-- Recent transactions -->
    <div class="card" style="margin-top:18px;">
      <h3>Recent Transactions</h3>
      <table>
        <thead><tr><th>When</th><th>Dir</th><th>Amount</th><th>Memo</th></tr></thead>
        <tbody id="txBody">
          {% for t in txs %}
          <tr><td>{{ t.when }}</td><td>{{ t.direction }}</td><td>{{ t.amount }}</td><td>{{ t.memo }}</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

<script>
  const form = document.getElementById('xferForm');
  const msg = document.getElementById('xferMsg');
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    msg.textContent = 'Processing...';
    const data = new FormData(form);
    try {
      const res = await fetch('/transfer', { method:'POST', body:data });
      const js = await res.json();
      if (!res.ok || !js.ok) throw new Error(js.error || 'transfer failed');
      // Update balances
      document.querySelector(`[name="fromAccount"]`).value; // keep selection
      // If source was selected, update it
      const srcId = data.get('fromAccount');
      const dstUser = data.get('toUser');
      const dstAcct = data.get('toAccount');
      document.getElementById('bal-'+srcId).textContent = js.srcBalance;
      msg.textContent = `Sent to ${dstUser} (${dstAcct}). New balance: ${js.srcBalance}`;
      form.reset();
      // Reload page to refresh transactions (simple)
      setTimeout(()=> location.reload(), 600);
    } catch (err) {
      msg.style.color = '#ffb4b4';
      msg.textContent = err.message;
    }
  });
</script>
</body>
</html>
